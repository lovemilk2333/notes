---
import { Icon } from "astro-icon/components";
import { licenseConfig, profileConfig, siteConfig } from "../../config";
import I18nKey from "../../i18n/i18nKey";
import { i18n } from "../../i18n/translation";
import { formatDateToYYYYMMDD, getPermalink, getCopyright } from "../../utils/date-utils";
import type { SiteConfig } from "@/types/config";

interface Props {
    title: string;
    slug: string;
    published: Date;
    class: string;
    copyright?: string | { name: string; url: string };
    permalink?: SiteConfig["permalink"];
}

const { title, published, copyright, permalink } = Astro.props;
const className = Astro.props.class;
const profileConf = profileConfig;

const licenseConf = getCopyright(copyright)
const licenseHasURL = !!licenseConf.url;
const licenseMaybeCC = licenseConf.name.toLocaleLowerCase().includes("cc-");
// const postUrl = decodeURIComponent(Astro.url.toString());
// LOVEMILK: change link to permalink
const url = Astro.url;
const postUrl = decodeURIComponent(getPermalink(url, permalink).href);
---

<div class={`relative transition overflow-hidden bg-[var(--license-block-bg)] py-5 px-6 ${className}`}>
    <div class="transition font-bold text-black/75 dark:text-white/75">
        {title}
    </div>
    <div class="transition text-black/30 dark:text-white/30 text-sm">
        {i18n(I18nKey.xPermalink)}
        <a href={postUrl} class="link text-[var(--primary)]" style="margin-inline-start: .5em;">
            {postUrl}
        </a>
    </div>
    <div class="flex gap-6 mt-2">
        <div>
            <div class="transition text-black/30 dark:text-white/30 text-sm">{i18n(I18nKey.author)}</div>
            <div class="transition text-black/75 dark:text-white/75 line-clamp-2">{profileConf.name}</div>
        </div>
        <div>
            <div class="transition text-black/30 dark:text-white/30 text-sm">{i18n(I18nKey.publishedAt)}</div>
            <div class="transition text-black/75 dark:text-white/75 line-clamp-2">{formatDateToYYYYMMDD(published)}</div>
        </div>
        <div>
            <div class="transition text-black/30 dark:text-white/30 text-sm">{i18n(I18nKey.license)}</div>
            {
                licenseHasURL ? (
                    <a href={licenseConf.url} target="_blank" class="link text-[var(--primary)] line-clamp-2">
                        {licenseConf.name}
                    </a>
                ) : (
                    <p class="transition text-black/75 dark:text-white/75 line-clamp-2">{licenseConf.name}</p>
                )
            }
        </div>
    </div>
    {
        licenseMaybeCC ? (
            <Icon
                name="fa6-brands:creative-commons"
                class="transition text-[15rem] absolute pointer-events-none right-6 top-1/2 -translate-y-1/2 text-black/5 dark:text-white/5"
            />
        ) : (
            void 0
        )
    }
</div>
